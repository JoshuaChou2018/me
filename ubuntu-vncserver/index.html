<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Ubuntu配置VNCServer，一定能用，不白屏灰屏 - Juexiao Zhou 周觉晓</title><meta name="Description" content="Juexiao Zhou&#39;s personal site"><meta property="og:url" content="https://www.joshuachou.ink/ubuntu-vncserver/">
  <meta property="og:site_name" content="Juexiao Zhou 周觉晓">
  <meta property="og:title" content="Ubuntu配置VNCServer，一定能用，不白屏灰屏">
  <meta property="og:description" content="安装基础软件
1 2 3 4 5 6 7 8 sudo apt update sudo apt-get upgrade sudo apt-get install gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal sudo apt install tightvncserver vncserver 注: 在防火墙上打开 VNC Server 的监听端口 VNC Server 用到了三个端口：5801(*)、5901(*)、6001 修改~/.vnc/xstartup
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #!/bin/bash export $(dbus-launch) export XKL_XMODMAP_DISABLE=1 export XDG_CURRENT_DESKTOP=&#34;GNOME-Flashback:Unity&#34; export XDG_MENU_PREFIX=&#34;gnome-flashback-&#34; unset SESSION_MANAGER gnome-panel &amp; gnome-settings-daemon &amp; metacity &amp; nautilus &amp; gnome-terminal &amp; # [ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup # [ -r $HOME/.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-08-22T15:14:51+03:00">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Ubuntu">
    <meta property="og:image" content="https://www.joshuachou.ink/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.joshuachou.ink/logo.png">
  <meta name="twitter:title" content="Ubuntu配置VNCServer，一定能用，不白屏灰屏">
  <meta name="twitter:description" content="安装基础软件
1 2 3 4 5 6 7 8 sudo apt update sudo apt-get upgrade sudo apt-get install gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal sudo apt install tightvncserver vncserver 注: 在防火墙上打开 VNC Server 的监听端口 VNC Server 用到了三个端口：5801(*)、5901(*)、6001 修改~/.vnc/xstartup
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 #!/bin/bash export $(dbus-launch) export XKL_XMODMAP_DISABLE=1 export XDG_CURRENT_DESKTOP=&#34;GNOME-Flashback:Unity&#34; export XDG_MENU_PREFIX=&#34;gnome-flashback-&#34; unset SESSION_MANAGER gnome-panel &amp; gnome-settings-daemon &amp; metacity &amp; nautilus &amp; gnome-terminal &amp; # [ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup # [ -r $HOME/.">
<meta name="application-name" content="Juexiao Zhou">
<meta name="apple-mobile-web-app-title" content="Juexiao Zhou"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.joshuachou.ink/ubuntu-vncserver/" /><link rel="prev" href="https://www.joshuachou.ink/cuda-unknown-error-this-may-be-due-to-an-incorrectly-set-up-environment/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Ubuntu配置VNCServer，一定能用，不白屏灰屏",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.joshuachou.ink\/ubuntu-vncserver\/"
        },"image": ["https:\/\/www.joshuachou.ink\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "linux, ubuntu","wordcount":  868 ,
        "url": "https:\/\/www.joshuachou.ink\/ubuntu-vncserver\/","datePublished": "2024-07-02T00:00:00+00:00","dateModified": "2024-08-22T15:14:51+03:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/www.joshuachou.ink\/images\/avatar.png",
                    "width":  2132 ,
                    "height":  2132 
                }},"author": {
                "@type": "Person",
                "name": "Juexiao Zhou"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Juexiao Zhou 周觉晓">Juexiao Zhou</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/about/" title="Me"> Me </a><a class="menu-item" href="/news/" title="News"> News </a><a class="menu-item" href="/publications/" title="Publications"> Publications </a><a class="menu-item" href="/mentoring/" title="Mentoring"> Mentoring </a><a class="menu-item" href="/press/" title="Press"> Press </a><a class="menu-item" href="/posts/" title="Posts"> Posts </a><a class="menu-item" href="/life/" title="Life"> Life </a><a class="menu-item" href="/categories/" title="Categories"> Categories </a><a class="menu-item" href="/calendar/" title="Calendar"> Calendar </a><a class="menu-item" href="/docs/" title="Docs"> Docs </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Juexiao Zhou 周觉晓">Juexiao Zhou</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/about/" title="Me">Me</a><a class="menu-item" href="/news/" title="News">News</a><a class="menu-item" href="/publications/" title="Publications">Publications</a><a class="menu-item" href="/mentoring/" title="Mentoring">Mentoring</a><a class="menu-item" href="/press/" title="Press">Press</a><a class="menu-item" href="/posts/" title="Posts">Posts</a><a class="menu-item" href="/life/" title="Life">Life</a><a class="menu-item" href="/categories/" title="Categories">Categories</a><a class="menu-item" href="/calendar/" title="Calendar">Calendar</a><a class="menu-item" href="/docs/" title="Docs">Docs</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Ubuntu配置VNCServer，一定能用，不白屏灰屏</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Juexiao Zhou</a></span>&nbsp;<span class="post-category">included in <a href="/categories/linux/"><i class="far fa-folder fa-fw"></i>Linux</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2024-07-02">2024-07-02</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;868 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#机器无显示屏情况-设置虚拟显示屏-转自httpsleimaogithubioblogremote-linux-desktop">机器无显示屏情况-设置虚拟显示屏 [转自：https://leimao.github.io/blog/Remote-Linux-Desktop/]</a>
      <ul>
        <li><a href="#set-up-remote-linux-desktop">Set Up Remote Linux Desktop</a></li>
        <li><a href="#x-forwarding">X Forwarding</a></li>
        <li><a href="#linux-desktop-forwarding">Linux Desktop Forwarding</a></li>
        <li><a href="#linux-desktop-forwarding-via-vnc">Linux Desktop Forwarding via VNC</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><ul>
<li>
<p>安装基础软件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo apt update
</span></span><span class="line"><span class="cl">sudo apt-get upgrade
</span></span><span class="line"><span class="cl">sudo apt-get install gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal
</span></span><span class="line"><span class="cl">sudo apt install tightvncserver
</span></span><span class="line"><span class="cl">vncserver
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">注: 在防火墙上打开 VNC Server 的监听端口
</span></span><span class="line"><span class="cl">VNC Server 用到了三个端口：5801(*)、5901(*)、6001
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>修改~/.vnc/xstartup</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">export</span> <span class="k">$(</span>dbus-launch<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">XKL_XMODMAP_DISABLE</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">XDG_CURRENT_DESKTOP</span><span class="o">=</span><span class="s2">&#34;GNOME-Flashback:Unity&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">XDG_MENU_PREFIX</span><span class="o">=</span><span class="s2">&#34;gnome-flashback-&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">unset</span> SESSION_MANAGER
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gnome-panel <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">gnome-settings-daemon <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">metacity <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">nautilus <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">gnome-terminal <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># [ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup</span>
</span></span><span class="line"><span class="cl"><span class="c1"># [ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">autocutsel -fork
</span></span><span class="line"><span class="cl">xrdb <span class="nv">$HOME</span>/.Xresources
</span></span><span class="line"><span class="cl">xsetroot -solid grey
</span></span><span class="line"><span class="cl">vncconfig -iconic <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">x-terminal-emulator -geometry 80x24+10+10 -ls -title <span class="s2">&#34;</span><span class="nv">$VNCDESKTOP</span><span class="s2"> Desktop&#34;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">gnome-session --session<span class="o">=</span>gnome-flashback-metacity --disable-acceleration-check --debug <span class="p">&amp;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">chmod +x ~/.vnc/xstartup
</span></span><span class="line"><span class="cl">vncserver :1
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="机器无显示屏情况-设置虚拟显示屏-转自httpsleimaogithubioblogremote-linux-desktop">机器无显示屏情况-设置虚拟显示屏 [转自：https://leimao.github.io/blog/Remote-Linux-Desktop/]</h2>
<h3 id="set-up-remote-linux-desktop">Set Up Remote Linux Desktop</h3>
<h3 id="x-forwarding">X Forwarding</h3>
<p>We have to first enable X forwarding.</p>
<p>We SSH to the remote Linux computer with <code>-XC</code> where <code>X</code> is the X service and <code>C</code> allows data compression.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ ssh -XC leimao@192.168.0.23
</span></span><span class="line"><span class="cl">Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.9.201-tegra aarch64)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> * Documentation:  https://help.ubuntu.com
</span></span><span class="line"><span class="cl"> * Management:     https://landscape.canonical.com
</span></span><span class="line"><span class="cl"> * Support:        https://ubuntu.com/advantage
</span></span><span class="line"><span class="cl">This system has been minimized by removing packages and content that are
</span></span><span class="line"><span class="cl">not required on a system that users do not log into.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To restore this content, you can run the &#39;unminimize&#39; command.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Last login: Sat May 15 09:18:28 2021 from 192.168.0.19
</span></span><span class="line"><span class="cl">/usr/bin/xauth:  file /home/leimao/.Xauthority does not exist
</span></span></code></pre></td></tr></table>
</div>
</div><p>We install <code>xauth</code> if it has not been installed on the remote Linux computer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ sudo apt update
</span></span><span class="line"><span class="cl">$ sudo apt install -y xauth
</span></span></code></pre></td></tr></table>
</div>
</div><p>Make sure <code>X11Forwarding</code> is <code>yes</code> in <code>/etc/ssh/sshd_config</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ cat /etc/ssh/sshd_config | grep X11Forwarding
</span></span><span class="line"><span class="cl">X11Forwarding yes
</span></span></code></pre></td></tr></table>
</div>
</div><p>Restart OpenSSH.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl restart sshd
</span></span></code></pre></td></tr></table>
</div>
</div><p>Confirm X forwarding is enabled.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ echo $DISPLAY
</span></span><span class="line"><span class="cl">localhost:10.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>Quick test X forwarding with X applications.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ sudo apt install -y x11-apps
</span></span><span class="line"><span class="cl">$ xclock
</span></span></code></pre></td></tr></table>
</div>
</div><p>The GUI of the X applications will show up on our local computer.</p>
<p>We could also try FireFox browser.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ sudo apt install -y firefox
</span></span><span class="line"><span class="cl">$ firefox
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="linux-desktop-forwarding">Linux Desktop Forwarding</h3>
<p>We have run single X applications successfully. Can we forward the entire remote Linux desktop? Sure, we can.</p>
<p>We will have to install the following dependencies.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ sudo touch /dev/fuse
</span></span><span class="line"><span class="cl">$ sudo apt install -y xfce4 xfce4-goodies gnome-icon-theme libcanberra-gtk-module
</span></span></code></pre></td></tr></table>
</div>
</div><p>Run the following command on the remote Linux computer while we are still <code>ssh -X</code> in.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ xfce4-session
</span></span></code></pre></td></tr></table>
</div>
</div><p>The forwarded desktop will show up on our local computer.</p>
<p>Opening X applications from the forwarded desktop is fine. But we were not able to open terminal to run commands.</p>
<h3 id="linux-desktop-forwarding-via-vnc">Linux Desktop Forwarding via VNC</h3>
<p>A better way to forward the Linux Desktop is to use VNC service.</p>
<p>To install the VNC server, we will install <code>tightvncserver</code> on the remote Linux computer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ sudo apt install -y tightvncserver
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then we could start a virtual desktop with an id of <code>1</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ vncserver :1 -geometry 1920x1080 -depth 24
</span></span></code></pre></td></tr></table>
</div>
</div><p>We could then connect to the remote Linux desktop using VNC client software on our local computer.</p>
<p><a href="https://remmina.org/" target="_blank" rel="noopener noreffer">Remmina</a> is installed by default on my local Ubuntu 20.04 LTS. Here we just have to input the remote Linux computer IP address with the VNC virtual desktop id, and press <code>Enter</code>.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/remmina.png"
        data-srcset="https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/remmina.png, https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/remmina.png 1.5x, https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/remmina.png 2x"
        data-sizes="auto"
        alt="https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/remmina.png"
        title="Remmina" /></p>
<p>Remmina</p>
<p>The connection was successful. However, we only see gray screen and could not do anything.</p>
<p>To fix this problem, we disconnect the VNC connection and kill the virtual desktop.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ vncserver -kill :1
</span></span></code></pre></td></tr></table>
</div>
</div><p>We will install <code>lxde</code> on the remote Linux computer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ sudo apt install -y lxde
</span></span></code></pre></td></tr></table>
</div>
</div><p>We will modify the <code>~/.vnc/xstartup</code> by adding <code>/usr/bin/startlxde</code> to it. The modified file will look like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat ~/.vnc/xstartup 
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/sh</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">xrdb <span class="nv">$HOME</span>/.Xresources
</span></span><span class="line"><span class="cl">xsetroot -solid grey
</span></span><span class="line"><span class="cl"><span class="c1">#x-terminal-emulator -geometry 80x24+10+10 -ls -title &#34;$VNCDESKTOP Desktop&#34; &amp;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#x-window-manager &amp;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Fix to make GNOME work</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">XKL_XMODMAP_DISABLE</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">/etc/X11/Xsession
</span></span><span class="line"><span class="cl">/usr/bin/startlxde
</span></span></code></pre></td></tr></table>
</div>
</div><p>Finally, restart VNC server.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ vncserver :1 -geometry 1920x1080 -depth 24
</span></span></code></pre></td></tr></table>
</div>
</div><p>This time, the remote Linux desktop shows correctly in Remmina.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/vnc.png"
        data-srcset="https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/vnc.png, https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/vnc.png 1.5x, https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/vnc.png 2x"
        data-sizes="auto"
        alt="https://leimao.github.io/images/blog/2021-06-30-Remote-Linux-Desktop/vnc.png"
        title="Remote Linux Desktop" /></p>
<p>Remote Linux Desktop</p>
<p>There are some inconvenience that copy and paste text between the local computer and the remote desktop does not work. To fix this problem, again, we disconnect the VNC connection and kill the virtual desktop.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ vncserver -kill :1
</span></span></code></pre></td></tr></table>
</div>
</div><p>We will install <code>autocutsel</code> on the remote Linux computer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ sudo apt install -y autocutsel
</span></span></code></pre></td></tr></table>
</div>
</div><p>We will modify the <code>~/.vnc/xstartup</code> by adding <code>autocutsel -fork</code> to it. The modified file will look like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat ~/.vnc/xstartup 
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/sh</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">xrdb <span class="nv">$HOME</span>/.Xresources
</span></span><span class="line"><span class="cl">xsetroot -solid grey
</span></span><span class="line"><span class="cl">autocutsel -fork
</span></span><span class="line"><span class="cl"><span class="c1">#x-terminal-emulator -geometry 80x24+10+10 -ls -title &#34;$VNCDESKTOP Desktop&#34; &amp;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#x-window-manager &amp;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Fix to make GNOME work</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">XKL_XMODMAP_DISABLE</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">/etc/X11/Xsession
</span></span><span class="line"><span class="cl">/usr/bin/startlxde
</span></span></code></pre></td></tr></table>
</div>
</div><p>Finally, restart VNC server.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ vncserver :1 -geometry 1920x1080 -depth 24
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, we could copy and paste easily between the local computer and the remote desktop.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://blog.ssdnodes.com/blog/remote-linux-desktop-vps-ssh-vnc/" target="_blank" rel="noopener noreffer">Remote Linux Desktop on Your VPS with SSH and VNC</a></li>
<li><a href="https://youtu.be/_8YZst2x9GE" target="_blank" rel="noopener noreffer">Grey Screen Comes on Connecting to VNC Server</a></li>
<li><a href="https://leimao.github.io/blog/Running-X-Client-Using-Virtual-X-Server-Xvfb/" target="_blank" rel="noopener noreffer">Running X Client Using Virtual X Server Xvfb</a></li>
<li><a href="https://youtu.be/npiX-11kBUU" target="_blank" rel="noopener noreffer">Raspberry Pi: Enabling Copy and Paste over VNC</a></li>
<li><a href="https://leimao.github.io/blog/Remote-Linux-Desktop/" target="_blank" rel="noopener noreffer">https://leimao.github.io/blog/Remote-Linux-Desktop/</a></li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-08-22&nbsp;<a class="git-hash" href="https://github.com/JoshuaChou2018/me.hugo/commit/03e9baaf6b0c021ddc67c24b1d07b9291dd5f300" target="_blank" title="commit by Juexiao Zhou(maybechou@live.com) 03e9baaf6b0c021ddc67c24b1d07b9291dd5f300: 1">
                                    <i class="fas fa-hashtag fa-fw"></i>03e9baa</a></span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/ubuntu-vncserver/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://www.joshuachou.ink/ubuntu-vncserver/" data-title="Ubuntu配置VNCServer，一定能用，不白屏灰屏" data-hashtags="linux,ubuntu"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://www.joshuachou.ink/ubuntu-vncserver/" data-hashtag="linux"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://www.joshuachou.ink/ubuntu-vncserver/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://www.joshuachou.ink/ubuntu-vncserver/" data-title="Ubuntu配置VNCServer，一定能用，不白屏灰屏" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://www.joshuachou.ink/ubuntu-vncserver/" data-title="Ubuntu配置VNCServer，一定能用，不白屏灰屏"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://www.joshuachou.ink/ubuntu-vncserver/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://www.joshuachou.ink/ubuntu-vncserver/" data-title="Ubuntu配置VNCServer，一定能用，不白屏灰屏"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://www.joshuachou.ink/ubuntu-vncserver/" data-title="Ubuntu配置VNCServer，一定能用，不白屏灰屏" data-ralateuid="6285763593"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="Share on Evernote" data-sharer="evernote" data-url="https://www.joshuachou.ink/ubuntu-vncserver/" data-title="Ubuntu配置VNCServer，一定能用，不白屏灰屏"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/linux/">Linux</a>,&nbsp;<a href="/tags/ubuntu/">Ubuntu</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/cuda-unknown-error-this-may-be-due-to-an-incorrectly-set-up-environment/" class="prev" rel="prev" title="CUDA unknown error - this may be due to an incorrectly set up environment"><i class="fas fa-angle-left fa-fw"></i>CUDA unknown error - this may be due to an incorrectly set up environment</a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><script type="text/javascript" src="//rf.revolvermaps.com/0/0/6.js?i=5f0suf0rff6&amp;m=7&amp;c=54ff00&amp;cr1=ffffff&amp;f=arial&amp;l=0&amp;bv=80" async="async"></script>

            <div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Juexiao Zhou</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/twemoji@13.0.0/dist/twemoji.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"url","label":"","lightTheme":"github-light","repo":"JoshuaChou2018/me"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":30,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"},"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
